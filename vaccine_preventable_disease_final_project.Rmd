---
title: Visualizing vaccine preventable disease cases in California
subtitle: CUNY Data 608 final project
author: Heather Geiger
date: May 14, 2019
output:
 html_document:
  smart: false
---

# Background

The 20th century saw great reductions in incidences of diseases such as polio through the use of vaccines as a preventative measure.

Unfortunately, in the 21st century we are now seeing a reemergence of vaccine-preventable diseases as the anti-vaccination movement gains more traction in certain segments of society.

This is a major problem for public health.

In this project, I will use data on incidences of vaccine-preventable diseases (including diptheria, pertussis, etc.) to document how the incidence of these diseases has changed over the past 10-20 or so years.

I will also place these incidences in a geographic context, which perhaps may highlight where vaccine-preventable diseases (possibly correlated with higher anti-vaccination adherence) are especially prevalent.

All of this will be in relation to the state of California, which has a nice dataset available documenting vaccine-preventable diseases over a long time span and in great detail.

# Data

This data is available from the following link:

https://data.chhs.ca.gov/dataset/vaccine-preventable-disease-cases-by-county-and-year

I also have a copy of the CSV file used in this analysis available at my Github here:

https://raw.githubusercontent.com/hgeiger-CUNY/Data608_Spring2019/master/izb_odp_final_03262019.csv

From the website:

â€œThese data contain counts of Immunization Branch-related disease cases among California residents by county, disease, and year.

The California Department of Public Health (CDPH) maintains a mandatory, passive reporting system for a list of communicable disease cases and outbreaks. The CDPH Immunization Branch conducts surveillance for vaccine preventable diseases. Health care providers and laboratories are mandated to report cases or suspected cases of these communicable diseases to their local health department (LHD). LHDs are also mandated to report these cases to CDPH."

This dataset contains information on all 58 counties in California, plus a statewide total across all counties.

Diseases include: Diphtheria, Hepatitis A, Hepatitis B, acute, Hepatitis C, acute, Invasive Meningococcal Disease, Measles, Mumps, Pertussis, Rubella, Tetanus, and Varicella Hospitalizations.

Data spans 2001-2017 overall. However, mumps, rubella, and varicella hospitalizations were not measured in this dataset until 2010, while all three forms of hepatitis were not measured until 2011.

# Data exploration

```{r, echo=FALSE,message=FALSE,warning=FALSE}
#Load libraries.

library(ggplot2)
library(tidyr)
library(dplyr)
```

```{r, echo=FALSE}
#Read in data.
#Then separate lines where county="California" (statewide totals) from the remainder of the data.

mydata <- read.csv("https://raw.githubusercontent.com/hgeiger-CUNY/Data608_Spring2019/master/izb_odp_final_03262019.csv",header=TRUE,stringsAsFactors=FALSE)

statewide_totals <- mydata[mydata$county == "California",]

mydata <- mydata[mydata$county != "California",]
```

Let's start with a simple look at the count of cases per combination of disease, county, and year.

```{r,echo=FALSE}
mydata_with_count_groups <- mydata %>% mutate(count.group = cut(count,breaks=c(-1,0,1,4,9,19,49,99,249,499,Inf),labels=c("0","1","2-4","5-9","10-19","20-49","50-99","100-249","250-499","500+")))

count_groups_summary <- mydata_with_count_groups %>% group_by(count.group) %>% summarise(num_combinations = length(count.group))

ggplot(count_groups_summary,
	aes(x=count.group,y=num_combinations)) +
	geom_bar(stat="identity",fill="lightgrey",col="black") +
	geom_text(aes(label=num_combinations), vjust=0) +
	xlab("Cases") +
	ylab("Combinations of disease + county + year")
```

We find many cases of 0 counts, indicating no cases of that particular disease in the given county and year.

Or if a particular disease was found in a given county and year, it often only has one or a handful of cases.

But then, there are a few outliers of 500+ cases of a disease in a county in a single year.

Let's also look at totals by disease, county, and year.

```{r,echo=FALSE}
sum_per_var <- mydata %>% group_by(disease) %>% summarise(total = sum(count))
sum_per_var <- data.frame(sum_per_var,stringsAsFactors=FALSE)

sum_per_var[,1] <- factor(sum_per_var[,1],levels=as.vector(sum_per_var[,1])[order(sum_per_var[,2],decreasing=TRUE)])

ggplot(sum_per_var,
	aes(x=disease,y=total)) +
	geom_bar(stat="identity",fill="lightgrey",col="black") +
	geom_text(aes(label=total),vjust=0) +
	ylab("Number of cases") +
	xlab("") +
	theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```

```{r,echo=FALSE}
sum_per_var <- mydata %>% group_by(county) %>% summarise(total = sum(count))
sum_per_var <- data.frame(sum_per_var,stringsAsFactors=FALSE)

sum_per_var[,1] <- as.vector(sum_per_var[,1])

sum_per_var <- sum_per_var[order(sum_per_var[,2],decreasing=TRUE),]
sum_per_var <- sum_per_var[1:20,]

sum_per_var[,1] <- factor(sum_per_var[,1],levels=as.vector(sum_per_var[,1])[order(sum_per_var[,2],decreasing=TRUE)])

ggplot(sum_per_var,
    aes(x=county,y=total)) +
	geom_bar(stat="identity",fill="lightgrey",col="black") +
    geom_text(aes(label=total),vjust=0) +
    ylab("Number of cases") +
    xlab("") +
	ggtitle("Showing top 20 counties by number of total cases 2001-2017") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```

```{r,echo=FALSE}
sum_per_var <- mydata %>% group_by(year) %>% summarise(total = sum(count))
sum_per_var <- data.frame(sum_per_var,stringsAsFactors=FALSE)

sum_per_var[,1] <- factor(sum_per_var[,1],levels=as.vector(sum_per_var[,1])[order(as.numeric(as.vector(sum_per_var[,1])))])

ggplot(sum_per_var,
    aes(x=year,y=total)) +
    geom_bar(stat="identity",fill="lightgrey",col="black") +
    geom_text(aes(label=total),vjust=0) +
    ylab("Number of cases") +
    xlab("") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```

We find the overwhelming number of cases in the data set are from pertussis.

Interestingly because measles has been in the news a lot lately, but measles is actually relatively rare at least in this data set. Although, keep in mind that this data set only goes up to 2017.

Los Angeles and San Diego counties lead in total number of cases, but presumably these are among the more populous counties. This underscores the need to normalize for population here.

Finally, we find spikes in the total number of cases statewide in 2010 and 2014.
